import os
import shutil
import subprocess
import json
import requests
from datetime import datetime

# ==========================================
# ğŸ› ï¸ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
# ==========================================
def create_file(path, content):
    directory = os.path.dirname(path)
    if directory and not os.path.exists(directory):
        os.makedirs(directory)
    with open(path, "w", encoding="utf-8") as f:
        f.write(content.strip())
    print(f"âœ… Created: {path}")

def clean_structure():
    # ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
    if os.path.exists("app/src/main/java/org/alituama/mytube"):
        shutil.rmtree("app/src/main/java/org/alituama/mytube")
    print("ğŸ§¹ Workspace cleaned.")

# ==========================================
# 1. Ù…Ù„ÙØ§Øª Gradle
# ==========================================
build_gradle_content = """
plugins {
    id("com.android.application")
    id("org.jetbrains.kotlin.android")
}

android {
    namespace = "org.alituama.mytube"
    compileSdk = 34

    defaultConfig {
        applicationId = "org.alituama.mytube"
        minSdk = 24
        targetSdk = 34
        versionCode = 1
        versionName = "1.0"
        
        ndk {
            abiFilters.add("armeabi-v7a")
            abiFilters.add("arm64-v8a")
        }
    }
    buildTypes {
        release {
            isMinifyEnabled = false
            proguardFiles(getDefaultProguardFile("proguard-android-optimize.txt"), "proguard-rules.pro")
        }
    }
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }
    kotlinOptions { jvmTarget = "1.8" }
    buildFeatures { viewBinding = true }
}

dependencies {
    implementation("androidx.core:core-ktx:1.12.0")
    implementation("androidx.appcompat:appcompat:1.6.1")
    implementation("com.google.android.material:material:1.11.0")
    implementation("androidx.constraintlayout:constraintlayout:2.1.4")
    
    // Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¯ÙˆÙ† JavaScript
    implementation("com.github.yausername.youtubedl-android:library:0.16.1")
    
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.1")
    implementation("androidx.lifecycle:lifecycle-runtime-ktx:2.6.2")
}
"""

settings_gradle_content = """
pluginManagement {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()
        maven { url = uri("https://jitpack.io") }
    }
}
rootProject.name = "MyTube"
include(":app")
"""

gradle_properties_content = """
org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8android.useAndroidX=true
android.enableJetifier=true
"""

local_properties_content = """
sdk.dir=/home/coder/.local/share/android-sdk
ndk.dir=/home/coder/.local/share/android-sdk/ndk/25.1.8937393
"""

# ==========================================
# 2. AndroidManifest.xml
# ==========================================
manifest_content = """<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />

    <application
        android:allowBackup="true"
        android:dataExtractionRules="@xml/data_extraction_rules"
        android:fullBackupContent="@xml/backup_rules"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.MyTube"
        tools:targetApi="31">
        
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:windowSoftInputMode="adjustResize">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
            
            <!-- Ø¯Ø¹Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· -->
            <intent-filter android:autoVerify="true">
                <action android:name="android.intent.action.SEND" />
                <category android:name="android.intent.category.DEFAULT" />
                <data android:mimeType="text/plain" />
            </intent-filter>
        </activity>
    </application>
</manifest>
"""

# ==========================================
# 3. MainActivity.kt Ø§Ù„Ù…Ø­Ø³Ù†
# ==========================================
main_activity_code = """package org.alituama.mytube

import android.Manifest
import android.content.ClipboardManager
import android.content.Context
import android.content.Intent
import android.content.pm.PackageManager
import android.os.Build
import android.os.Bundle
import android.os.Environment
import android.text.Editable
import android.text.TextWatcher
import android.util.Log
import android.widget.Button
import android.widget.ProgressBar
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.app.AlertDialog
import androidx.appcompat.app.AppCompatActivity
import androidx.core.app.ActivityCompat
import androidx.core.content.ContextCompat
import androidx.lifecycle.lifecycleScope
import com.google.android.material.textfield.TextInputEditText
import com.yausername.youtubedl_android.YoutubeDL
import com.yausername.youtubedl_android.YoutubeDLRequest
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext
import java.io.File
import java.net.URL

class MainActivity : AppCompatActivity() {

    private lateinit var etUrl: TextInputEditText
    private lateinit var tvStatus: TextView
    private lateinit var progressBar: ProgressBar
    private var isInitialized = false

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        initViews()        checkPermissions()
        initializeDownloader()

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØµÙˆØµ
        handleSharedIntent()

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ø­Ù‚Ù„
        etUrl.addTextChangedListener(object : TextWatcher {
            override fun afterTextChanged(s: Editable?) {
                val text = s.toString().trim()
                if (isValidYouTubeUrl(text)) {
                    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù‡Ù†Ø§
                }
            }
            
            override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) {}
            override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) {}
        })
    }

    private fun initViews() {
        etUrl = findViewById(R.id.etUrl)
        tvStatus = findViewById(R.id.tvStatus)
        progressBar = findViewById(R.id.progressBar)
        val btnDownload = findViewById<Button>(R.id.btnDownload)

        btnDownload.setOnClickListener {
            val url = etUrl.text.toString().trim()
            if (url.isNotEmpty()) {
                startDownload(url)
            } else {
                checkClipboardAndDownload()
            }
        }
    }

    private fun initializeDownloader() {
        lifecycleScope.launch(Dispatchers.IO) {
            try {
                withContext(Dispatchers.Main) {
                    tvStatus.text = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©..."
                    progressBar.visibility = ProgressBar.VISIBLE
                }
                
                YoutubeDL.getInstance().init(application)
                
                withContext(Dispatchers.Main) {
                    tvStatus.text = "Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù…ÙŠÙ„"
                    progressBar.visibility = ProgressBar.GONE
                    isInitialized = true                    
                    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                    val savedUrl = etUrl.text.toString().trim()
                    if (savedUrl.isNotEmpty() && isValidYouTubeUrl(savedUrl)) {
                        startDownload(savedUrl)
                    }
                }
            } catch (e: Exception) {
                withContext(Dispatchers.Main) {
                    tvStatus.text = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©: ${e.message}"
                    progressBar.visibility = ProgressBar.GONE
                    Log.e("MainActivity", "Initialization error", e)
                }
            }
        }
    }

    private fun startDownload(url: String) {
        if (!isInitialized) {
            Toast.makeText(this, "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù… ÙŠÙƒØªÙ…Ù„ ØªÙ‡ÙŠØ¦ØªÙ‡", Toast.LENGTH_SHORT).show()
            return
        }

        if (!isValidYouTubeUrl(url)) {
            Toast.makeText(this, "Ø±Ø§Ø¨Ø· YouTube ØºÙŠØ± ØµØ­ÙŠØ­", Toast.LENGTH_SHORT).show()
            return
        }

        lifecycleScope.launch(Dispatchers.IO) {
            try {
                withContext(Dispatchers.Main) {
                    tvStatus.text = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."
                    progressBar.visibility = ProgressBar.VISIBLE
                }

                val downloadDir = File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS), "MyTube")
                if (!downloadDir.exists()) {
                    downloadDir.mkdirs()
                }

                val request = YoutubeDLRequest(url)
                request.addOption("-o", "${downloadDir.absolutePath}/%(title)s.%(ext)s")
                request.addOption("-f", "best[height<=1080][ext=mp4]")
                
                // ØªØ¬Ø§ÙˆØ² JavaScript
                request.addOption("--extractor-args", "youtube:player_client=android,youtube:player_skip=webpage")
                request.addOption("--no-check-certificates")
                request.addOption("--no-playlist")

                val response = YoutubeDL.getInstance().execute(request)
                withContext(Dispatchers.Main) {
                    progressBar.visibility = ProgressBar.GONE
                    if (response.error) {
                        tvStatus.text = "ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„"
                        showErrorDialog("Ø®Ø·Ø£: ${response.outcome}")
                    } else {
                        tvStatus.text = "ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!"
                        Toast.makeText(this@MainActivity, "ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ", Toast.LENGTH_LONG).show()
                        etUrl.setText("")
                    }
                }
            } catch (e: Exception) {
                withContext(Dispatchers.Main) {
                    progressBar.visibility = ProgressBar.GONE
                    tvStatus.text = "Ø®Ø·Ø£: ${e.message}"
                    showErrorDialog(e.message ?: "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ")
                    Log.e("MainActivity", "Download error", e)
                }
            }
        }
    }

    private fun checkClipboardAndDownload() {
        val clipboard = getSystemService(Context.CLIPBOARD_SERVICE) as ClipboardManager
        val clip = clipboard.primaryClip
        if (clip != null && clip.itemCount > 0) {
            val text = clip.getItemAt(0).text.toString()
            if (isValidYouTubeUrl(text)) {
                etUrl.setText(text)
                startDownload(text)
            } else {
                Toast.makeText(this, "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· YouTube ÙÙŠ Ø§Ù„Ø­Ø§ÙØ¸Ø©", Toast.LENGTH_SHORT).show()
            }
        } else {
            Toast.makeText(this, "Ø§Ù„Ø­Ø§ÙØ¸Ø© ÙØ§Ø±ØºØ©", Toast.LENGTH_SHORT).show()
        }
    }

    private fun handleSharedIntent() {
        if (intent?.action == Intent.ACTION_SEND) {
            intent.getStringExtra(Intent.EXTRA_TEXT)?.let { sharedText ->
                if (isValidYouTubeUrl(sharedText)) {
                    etUrl.setText(sharedText)
                    startDownload(sharedText)
                }
            }
        }
    }
    private fun isValidYouTubeUrl(url: String): Boolean {
        return url.contains("youtube.com/watch") || 
               url.contains("youtu.be/") ||
               url.contains("youtube.com/shorts/")
    }

    private fun showErrorDialog(message: String) {
        AlertDialog.Builder(this)
            .setTitle("Ø®Ø·Ø£")
            .setMessage(message)
            .setPositiveButton("Ù…ÙˆØ§ÙÙ‚", null)
            .show()
    }

    private fun checkPermissions() {
        val permissions = mutableListOf<String>()
        
        if (ContextCompat.checkSelfPermission(this, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {
            permissions.add(Manifest.permission.WRITE_EXTERNAL_STORAGE)
        }
        
        if (ContextCompat.checkSelfPermission(this, Manifest.permission.READ_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {
            permissions.add(Manifest.permission.READ_EXTERNAL_STORAGE)
        }
        
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {
            if (ContextCompat.checkSelfPermission(this, Manifest.permission.POST_NOTIFICATIONS) != PackageManager.PERMISSION_GRANTED) {
                permissions.add(Manifest.permission.POST_NOTIFICATIONS)
            }
        }

        if (permissions.isNotEmpty()) {
            ActivityCompat.requestPermissions(this, permissions.toTypedArray(), 100)
        }
    }

    override fun onRequestPermissionsResult(requestCode: Int, permissions: Array<out String>, grantResults: IntArray) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults)
        if (requestCode == 100) {
            val allGranted = grantResults.all { it == PackageManager.PERMISSION_GRANTED }
            if (!allGranted) {
                Toast.makeText(this, "Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„", Toast.LENGTH_SHORT).show()
            }
        }
    }
}
"""

# ==========================================
# 4. Ù…Ù„ÙØ§Øª XML# ==========================================
activity_main_xml = """<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="16dp"
    android:background="#1e1e1e">

    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="MyTube Downloader"
        android:textSize="24sp"
        android:textStyle="bold"
        android:textColor="#ffffff"
        android:gravity="center"
        android:layout_marginBottom="24dp" />

    <com.google.android.material.textfield.TextInputLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:hint="Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ YouTube"
        style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox">

        <com.google.android.material.textfield.TextInputEditText
            android:id="@+id/etUrl"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:inputType="textUri"
            android:textColor="#ffffff"
            android:textColorHint="#888888" />

    </com.google.android.material.textfield.TextInputLayout>

    <Button
        android:id="@+id/btnDownload"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:text="ØªØ­Ù…ÙŠÙ„"
        android:textAllCaps="false"
        style="@style/Widget.MaterialComponents.Button" />

    <ProgressBar
        android:id="@+id/progressBar"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="center"
        android:layout_marginTop="24dp"        android:visibility="gone" />

    <TextView
        android:id="@+id/tvStatus"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:text="Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù…ÙŠÙ„..."
        android:textColor="#ffffff"
        android:gravity="center"
        android:textSize="14sp" />

    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:text="â€¢ Ø§Ù†Ø³Ø® Ø±Ø§Ø¨Ø· YouTube ÙˆØ§Ø¯Ø®Ù„Ù‡ Ù‡Ù†Ø§\\nâ€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† YouTube Ø¥Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚\\nâ€¢ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªÙ†Ø²ÙŠÙ„Ø§Øª"
        android:textColor="#aaaaaa"
        android:textSize="12sp" />

</LinearLayout>
"""

# ==========================================
# 5. Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø£Ø®Ø±Ù‰
# ==========================================
strings_xml = """<?xml version="1.0" encoding="utf-8"?>
<resources>
    <string name="app_name">MyTube</string>
    <string name="permission_rationale">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø­ÙØ¸ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</string>
</resources>
"""

themes_xml = """<?xml version="1.0" encoding="utf-8"?>
<resources>
    <style name="Theme.MyTube" parent="Theme.MaterialComponents.DayNight.DarkActionBar">
        <item name="colorPrimary">#FF0000</item>
        <item name="colorPrimaryVariant">#CC0000</item>
        <item name="colorOnPrimary">#FFFFFF</item>
        <item name="android:statusBarColor">?attr/colorPrimaryVariant</item>
    </style>
</resources>
"""

colors_xml = """<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="purple_200">#FFBB86FC</color>
    <color name="purple_500">#FF6200EE</color>
    <color name="purple_700">#FF3700B3</color>
    <color name="teal_200">#FF03DAC5</color>    <color name="teal_700">#FF018786</color>
    <color name="black">#FF000000</color>
    <color name="white">#FFFFFFFF</color>
    <color name="dark_gray">#FF1e1e1e</color>
</resources>
"""

backup_rules_xml = """<?xml version="1.0" encoding="utf-8"?>
<data-extraction-rules>
    <cloud-backup>
        <exclude domain="root" />
        <exclude domain="file" />
        <exclude domain="database" />
        <exclude domain="sharedpref" />
        <exclude domain="external" />
    </cloud-backup>
    <device-transfer>
        <exclude domain="root" />
        <exclude domain="file" />
        <exclude domain="database" />
        <exclude domain="sharedpref" />
        <exclude domain="external" />
    </device-transfer>
</data-extraction-rules>
"""

data_extraction_rules_xml = """<?xml version="1.0" encoding="utf-8"?>
<resources>
    <bool name="enable_data_extraction_rules">true</bool>
</resources>
"""

# ==========================================
# 6. GitHub Action
# ==========================================
github_action_yaml = """name: Build APK

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
        - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
    
    - name: Setup Android SDK
      uses: android-actions/setup-android@v2
    
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
    
    - name: Build Debug APK
      run: ./gradlew assembleDebug
    
    - name: Upload APK
      uses: actions/upload-artifact@v3
      with:
        name: app-debug-apk
        path: app/build/outputs/apk/debug/app-debug.apk
"""

# ==========================================
# 7. README
# ==========================================
readme_content = """# MyTube Downloader

ØªØ·Ø¨ÙŠÙ‚ Android Ù„ØªØ­Ù…ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª YouTube Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©.

## Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª
- ØªØ­Ù…ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª YouTube Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©
- Ø¯Ø¹Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
- ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø³ÙŠØ·Ø© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
- ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªÙ†Ø²ÙŠÙ„Ø§Øª

## ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
1. Ø§Ù†Ø³Ø® Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ YouTube
2. Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·
3. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
4. Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„

## Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
- ÙŠØªØ·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù„Ø­ÙØ¸ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Android 7.0 ÙØ£Ø¹Ù„Ù‰
"""

# ==========================================
# ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
# ==========================================
def setup_project():    clean_structure()
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
    dirs = [
        "app/src/main/java/org/alituama/mytube",
        "app/src/main/res/layout",
        "app/src/main/res/values",
        "app/src/main/res/xml",
        "app/src/main/res/drawable",
        "app/src/main/res/mipmap-hdpi",
        "app/src/main/res/mipmap-mdpi",
        "app/src/main/res/mipmap-xhdpi",
        "app/src/main/res/mipmap-xxhdpi",
        "app/src/main/res/mipmap-xxxhdpi",
        ".github/workflows"
    ]
    
    for dir_path in dirs:
        os.makedirs(dir_path, exist_ok=True)
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„ÙØ§Øª
    create_file("build.gradle.kts", build_gradle_content)
    create_file("settings.gradle.kts", settings_gradle_content)
    create_file("gradle.properties", gradle_properties_content)
    create_file("local.properties", local_properties_content)
    
    create_file("app/build.gradle.kts", build_gradle_content)
    create_file("app/src/main/AndroidManifest.xml", manifest_content)
    create_file("app/src/main/java/org/alituama/mytube/MainActivity.kt", main_activity_code)
    
    create_file("app/src/main/res/layout/activity_main.xml", activity_main_xml)
    create_file("app/src/main/res/values/strings.xml", strings_xml)
    create_file("app/src/main/res/values/themes.xml", themes_xml)
    create_file("app/src/main/res/values/colors.xml", colors_xml)
    create_file("app/src/main/res/xml/backup_rules.xml", backup_rules_xml)
    create_file("app/src/main/res/xml/data_extraction_rules.xml", data_extraction_rules_xml)
    
    create_file(".github/workflows/android.yml", github_action_yaml)
    create_file("README.md", readme_content)
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ÙØ§Ø±ØºØ© (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
    icon_content = """<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="108dp"
    android:height="108dp"
    android:viewportWidth="108"
    android:viewportHeight="108">
  <path
      android:fillColor="#FF0000"
      android:pathData="M34,34 L74,34 L74,74 L34,74 Z"/></vector>"""
    
    icon_files = [
        "app/src/main/res/mipmap-hdpi/ic_launcher.xml",
        "app/src/main/res/mipmap-mdpi/ic_launcher.xml", 
        "app/src/main/res/mipmap-xhdpi/ic_launcher.xml",
        "app/src/main/res/mipmap-xxhdpi/ic_launcher.xml",
        "app/src/main/res/mipmap-xxxhdpi/ic_launcher.xml"
    ]
    
    for icon_file in icon_files:
        create_file(icon_file, icon_content)
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¬ÙˆÙ„Ù
    round_icon_content = """<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@color/red"/>
    <foreground android:drawable="@drawable/ic_launcher_foreground"/>
</adaptive-icon>"""
    
    create_file("app/src/main/res/mipmap-anydpi-v26/ic_launcher.xml", """<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@color/red"/>
    <foreground android:drawable="@drawable/ic_launcher_foreground"/>
</adaptive-icon>""")
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±
    create_file("app/src/main/res/values/colors.xml", """<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="purple_200">#FFBB86FC</color>
    <color name="purple_500">#FF6200EE</color>
    <color name="purple_700">#FF3700B3</color>
    <color name="teal_200">#FF03DAC5</color>
    <color name="teal_700">#FF018786</color>
    <color name="black">#FF000000</color>
    <color name="white">#FFFFFFFF</color>
    <color name="red">#FF0000</color>
    <color name="dark_gray">#FF1e1e1e</color>
</resources>""")
    
    print("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­!")

# ==========================================
# ØªÙ†ÙÙŠØ° Git
# ==========================================
def git_operations():
    try:
        # ØªÙ‡ÙŠØ¦Ø© Git Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        if not os.path.exists(".git"):
            subprocess.run(["git", "init"], check=True)            subprocess.run(["git", "config", "user.name", "alwansan"], check=True)
            subprocess.run(["git", "config", "user.email", "alwansan@example.com"], check=True)
        
        # Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
        subprocess.run(["git", "add", "."], check=True)
        
        # Ø¥Ù†Ø´Ø§Ø¡_commit
        subprocess.run(["git", "commit", "-m", "Initial commit: MyTube Downloader v1.0"], check=True)
        
        # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        repo_url = "https://github.com/alwansan/MyTube"
        subprocess.run(["git", "remote", "add", "origin", repo_url], check=False)  # Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        
        # Ø¯ÙØ¹ Ø¥Ù„Ù‰ main
        subprocess.run(["git", "branch", "-M", "main"], check=True)
        subprocess.run(["git", "push", "-u", "origin", "main", "--force"], check=True)
        
        print("âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ GitHub Ø¨Ù†Ø¬Ø§Ø­!")
        print("ğŸ”— https://github.com/alwansan/MyTube")
        
    except subprocess.CalledProcessError as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Git: {e}")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: {e}")

# ==========================================
# ØªÙ†ÙÙŠØ° ÙƒÙ„ Ø´ÙŠØ¡
# ==========================================
if __name__ == "__main__":
    print("ğŸš€ Ø¨Ø¯Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ MyTube...")
    setup_project()
    print("\nğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ GitHub...")
    git_operations()
    print("\nğŸ‰ ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹!")